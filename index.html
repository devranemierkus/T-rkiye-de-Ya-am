<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>TC YaÅŸam SimÃ¼lasyonu V2.0</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: #000;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #eee;
    }
    #ui {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.9);
      color: #fff;
      padding: 30px;
      box-sizing: border-box;
      z-index: 10;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    h1 {
      color: #4CAF50;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin: 10px 0;
      font-size: 1.1rem;
      width: 100%;
      max-width: 400px;
      text-align: left;
    }
    input, select {
      display: block;
      margin-top: 5px;
      padding: 12px;
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
      border: 1px solid #555;
      background: #333;
      color: #fff;
      border-radius: 5px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 15px 25px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1.1rem;
      margin-top: 20px;
      transition: background-color 0.3s ease;
      max-width: 300px;
      width: 100%;
    }
    button:hover {
      background-color: #45a049;
    }
    canvas { display: block; }
    #info, #event-overlay {
      position: absolute;
      background: rgba(0,0,0,0.7);
      padding: 15px;
      font-size: 16px;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,255,0,0.3);
      border: 1px solid #4CAF50;
    }
    #info {
      bottom: 20px;
      left: 20px;
      width: 300px;
    }
    #event-overlay {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      max-width: 600px;
      text-align: center;
      display: none; /* Hidden by default */
    }
    #event-overlay h2 {
      color: #FFEB3B;
      margin-top: 0;
    }
    #event-overlay p {
      margin-bottom: 20px;
    }
    #event-overlay button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 1rem;
      max-width: unset;
      width: auto;
    }
    .option-button {
      background-color: #2196F3;
    }
    .option-button:hover {
      background-color: #1976D2;
    }
    #military-info {
      position: absolute;
      top: 20px;
      right: 20px;
      color: white;
      background: rgba(0,0,0,0.7);
      padding: 10px;
      font-size: 14px;
      border-radius: 5px;
      display: none; /* Hidden until military service starts */
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <div id="ui">
    <h1>ğŸ¼ TC YaÅŸam SimÃ¼lasyonu ğŸ‡¹ğŸ‡·</h1>
    <label>Ad: <input id="name" placeholder="AdÄ±nÄ± gir"></label>
    <label>Soyad: <input id="surname" placeholder="SoyadÄ±nÄ± gir"></label>
    <label>DoÄŸum YÄ±lÄ±: <input type="number" id="year" value="2025"></label>
    <label>HastalÄ±k (isteÄŸe baÄŸlÄ±):
      <select id="disease">
        <option value="">Yok</option>
        <option value="kÃ¶r">GÃ¶rme Engeli</option>
        <option value="felc">FelÃ§</option>
        <option value="mide">Mide Sorunu</option>
      </select>
    </label>
    <label>Din SeÃ§:
      <select id="religion">
        <option value="yok">Yok</option>
        <option value="islam">Ä°slam</option>
        <option value="hristiyan">HristiyanlÄ±k</option>
        <option value="yahudi">Yahudilik</option>
        <option value="budist">Budizm</option>
      </select>
    </label>
    <button onclick="startLife()">Hayata BaÅŸla</button>
  </div>

  <div id="info"></div>
  <div id="event-overlay">
    <h2 id="event-title"></h2>
    <p id="event-message"></p>
    <div id="event-options"></div>
  </div>
  <div id="military-info">
    <p>Åafak SayacÄ±: <span id="safak-counter"></span> gÃ¼n</p>
    <p>Askerlik Durumu: <span id="military-status"></span></p>
  </div>

  <audio id="cry" src="https://www.soundjay.com/human/sounds/baby-crying-01.mp3"></audio>
  <audio id="voiceMom" src="https://www.soundjay.com/human/sounds/female-voice-01.mp3"></audio>
  <audio id="voiceDad" src="https://www.soundjay.com/human/sounds/male-voice-01.mp3"></audio>
  <audio id="explosion" src="https://www.soundjay.com/misc/sounds/explosion-01.mp3"></audio>
  <audio id="carHorn" src="https://www.soundjay.com/vehicles/sounds/car-horn-01.mp3"></audio>


  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  <script>
    // --- Three.js Setup ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById("gameCanvas"), antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor(0x333333); // A darker, more modern background
    camera.position.set(0, 2, 8); // Slightly higher and further back for a better view

    const ambientLight = new THREE.AmbientLight(0x404040, 2); // Soft ambient light
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
    directionalLight.position.set(5, 10, 7);
    directionalLight.castShadow = true;
    scene.add(directionalLight);

    // Ground plane
    const plane = new THREE.Mesh(
      new THREE.PlaneGeometry(50, 50),
      new THREE.MeshStandardMaterial({ color: 0x228B22, side: THREE.DoubleSide })
    );
    plane.rotation.x = Math.PI / 2;
    plane.receiveShadow = true;
    scene.add(plane);

    // Placeholder objects (can be replaced with more complex models later)
    let playerObject, currentEnvironment;

    function createBirthScene() {
      // Clear previous scene elements
      scene.children = scene.children.filter(obj => obj === ambientLight || obj === directionalLight || obj === plane);

      const baby = new THREE.Mesh(
        new THREE.SphereGeometry(0.4, 32, 32),
        new THREE.MeshStandardMaterial({ color: 0xffccaa, roughness: 0.7, metalness: 0.1 })
      );
      baby.position.y = 0.5;
      baby.name = "baby";
      scene.add(baby);

      const bed = new THREE.Mesh(
        new THREE.BoxGeometry(2, 0.2, 1),
        new THREE.MeshStandardMaterial({ color: 0x8b4513, roughness: 0.8 })
      );
      bed.position.y = 0;
      scene.add(bed);

      const mom = new THREE.Mesh(
        new THREE.SphereGeometry(0.4, 32, 32),
        new THREE.MeshStandardMaterial({ color: 0xffaaaa, roughness: 0.7, metalness: 0.1 })
      );
      mom.position.set(-1.5, 1.2, 0);
      mom.name = "mom";
      scene.add(mom);

      const dad = new THREE.Mesh(
        new THREE.SphereGeometry(0.4, 32, 32),
        new THREE.MeshStandardMaterial({ color: 0xaaaaff, roughness: 0.7, metalness: 0.1 })
      );
      dad.position.set(1.5, 1.2, 0);
      dad.name = "dad";
      scene.add(dad);

      // Simple eyes and mouth for baby
      const eyeGeometry = new THREE.SphereGeometry(0.03, 16, 16);
      const eyeMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
      const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
      leftEye.position.set(-0.1, 0.1, 0.38);
      baby.add(leftEye);
      const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
      rightEye.position.set(0.1, 0.1, 0.38);
      baby.add(rightEye);

      const mouthGeometry = new THREE.BoxGeometry(0.15, 0.03, 0.01);
      const mouth = new THREE.Mesh(mouthGeometry, eyeMaterial);
      mouth.position.set(0, -0.05, 0.38);
      baby.add(mouth);

      currentEnvironment = "birth";
    }

    function createHomeScene() {
      // Clear previous scene elements but keep lights and ground
      scene.children = scene.children.filter(obj => obj === ambientLight || obj === directionalLight || obj === plane);

      // Room elements
      const wallsMaterial = new THREE.MeshStandardMaterial({ color: 0x888888, side: THREE.BackSide });
      const floorMaterial = new THREE.MeshStandardMaterial({ color: 0x663300 });

      const walls = new THREE.Mesh(new THREE.BoxGeometry(10, 5, 10), wallsMaterial);
      walls.position.y = 2.5;
      scene.add(walls);

      const floor = new THREE.Mesh(new THREE.BoxGeometry(10, 0.1, 10), floorMaterial);
      floor.position.y = -0.05;
      scene.add(floor);

      // Player representation
      playerObject = new THREE.Mesh(
        new THREE.CapsuleGeometry(0.4, 1.0, 32, 32), // More human-like capsule
        new THREE.MeshStandardMaterial({ color: 0xffffcc, roughness: 0.6 })
      );
      playerObject.position.set(0, 0.8, 0); // Position it on the floor
      playerObject.castShadow = true;
      scene.add(playerObject);

      // Simple furniture
      const table = new THREE.Mesh(
        new THREE.BoxGeometry(1.5, 0.7, 0.8),
        new THREE.MeshStandardMaterial({ color: 0x552200 })
      );
      table.position.set(2, 0.35, -2);
      scene.add(table);

      const chair = new THREE.Mesh(
        new THREE.BoxGeometry(0.5, 0.8, 0.5),
        new THREE.MeshStandardMaterial({ color: 0x774411 })
      );
      chair.position.set(2, 0.4, -1.5);
      scene.add(chair);

      currentEnvironment = "home";
    }

    function createMilitaryScene() {
      scene.children = scene.children.filter(obj => obj === ambientLight || obj === directionalLight || obj === plane);

      // Barracks/Training Ground feel
      const barracksWall = new THREE.Mesh(
        new THREE.BoxGeometry(10, 3, 0.5),
        new THREE.MeshStandardMaterial({ color: 0x666666 })
      );
      barracksWall.position.set(0, 1.5, -4);
      scene.add(barracksWall);

      const tent = new THREE.Mesh(
        new THREE.ConeGeometry(1.5, 2, 4),
        new THREE.MeshStandardMaterial({ color: 0x8B4513 })
      );
      tent.position.set(3, 1, 0);
      scene.add(tent);

      if (playerObject) {
        playerObject.position.set(-2, 0.8, 2);
      }
      scene.add(playerObject); // Re-add player to new scene

      currentEnvironment = "military";
    }

    function createCityScene() {
      scene.children = scene.children.filter(obj => obj === ambientLight || obj === directionalLight || obj === plane);

      // Simple buildings
      const buildingMaterial = new THREE.MeshStandardMaterial({ color: 0x999999 });
      for (let i = 0; i < 5; i++) {
        const height = Math.random() * 5 + 3;
        const building = new THREE.Mesh(
          new THREE.BoxGeometry(Math.random() * 2 + 1, height, Math.random() * 2 + 1),
          buildingMaterial
        );
        building.position.set(Math.random() * 10 - 5, height / 2, Math.random() * 10 - 5);
        scene.add(building);
      }

      // Road
      const road = new THREE.Mesh(
        new THREE.BoxGeometry(10, 0.05, 50),
        new THREE.MeshStandardMaterial({ color: 0x444444 })
      );
      road.position.z = -15;
      scene.add(road);

      if (playerObject) {
        playerObject.position.set(0, 0.8, 5);
      }
      scene.add(playerObject);

      currentEnvironment = "city";
    }

    function animate() {
      requestAnimationFrame(animate);

      // Basic animations based on current scene
      if (currentEnvironment === "birth") {
        const baby = scene.getObjectByName("baby");
        if (baby) baby.rotation.y += 0.01;
        const mom = scene.getObjectByName("mom");
        if (mom) mom.rotation.y += 0.005;
        const dad = scene.getObjectByName("dad");
        if (dad) dad.rotation.y -= 0.005;
      } else if (playerObject) {
        // Player animation could be more complex, e.g., walking
        // For now, simple rotation
        playerObject.rotation.y += 0.005;
      }
      renderer.render(scene, camera);
    }
    animate();

    // --- Game Logic ---
    const info = document.getElementById("info");
    const eventOverlay = document.getElementById("event-overlay");
    const eventTitle = document.getElementById("event-title");
    const eventMessage = document.getElementById("event-message");
    const eventOptions = document.getElementById("event-options");
    const militaryInfoDiv = document.getElementById("military-info");
    const safakCounterSpan = document.getElementById("safak-counter");
    const militaryStatusSpan = document.getElementById("military-status");

    let player = {
      name: "",
      surname: "",
      year: 2025,
      age: 0,
      money: 0,
      disease: "",
      religion: "",
      family: Math.random() < 0.5 ? "Zengin" : "Fakir",
      karma: 0, // Amel Defteri
      hasCar: false,
      hasHouse: false,
      isMarried: false,
      militaryStatus: "Muaf DeÄŸil", // "Muaf DeÄŸil", "Askere Gitti", "Bedelli YaptÄ±", "Firari"
      militaryServiceRemaining: 0, // In days
      militaryDraftAttempts: 0
    };

    let ageInterval;
    let militaryInterval;

    function startLife() {
      player.name = document.getElementById("name").value || "Ä°simsiz";
      player.surname = document.getElementById("surname").value || "SoyadsÄ±z";
      player.year = parseInt(document.getElementById("year").value) || 2025;
      player.disease = document.getElementById("disease").value;
      player.religion = document.getElementById("religion").value;

      document.getElementById("cry").play();

      setTimeout(() => { document.getElementById("voiceMom").play(); }, 2000);
      setTimeout(() => { document.getElementById("voiceDad").play(); }, 4000);

      document.getElementById("ui").style.display = "none";

      if (player.disease === "kÃ¶r") {
        renderer.setClearColor(0x000000); // Black screen for blindness
      } else {
        createBirthScene();
      }

      setTimeout(() => {
        spawnAtHome();
      }, 6000);
    }

    function spawnAtHome() {
      createHomeScene();
      player.age = 0; // Start at age 0, not 1
      updateInfo();

      ageInterval = setInterval(() => {
        player.age++;
        updateInfo();
        handleLifeEvents();
      }, 5000); // Each 5 seconds is 1 year
    }

    function updateInfo() {
      info.innerText = `
        Ad: ${player.name} ${player.surname}
        YaÅŸ: ${player.age}
        Din: ${player.religion}
        Aile: ${player.family}
        Para: ${player.money}â‚º
        Karma: ${player.karma}
        Ev: ${player.hasHouse ? "Var" : "Yok"}
        Araba: ${player.hasCar ? "Var" : "Yok"}
        Evlilik: ${player.isMarried ? "Evli" : "Bekar"}
        Askerlik: ${player.militaryStatus}
      `;
    }

    function showEvent(title, message, options) {
      eventTitle.innerText = title;
      eventMessage.innerText = message;
      eventOptions.innerHTML = "";
      options.forEach(option => {
        const button = document.createElement("button");
        button.innerText = option.text;
        button.className = "option-button";
        button.onclick = () => {
          hideEvent();
          option.action();
        };
        eventOptions.appendChild(button);
      });
      eventOverlay.style.display = "flex";
    }

    function hideEvent() {
      eventOverlay.style.display = "none";
    }

    function handleLifeEvents() {
      // Basic childhood events
      if (player.age === 1 && player.disease !== "kÃ¶r") {
        showEvent("Ä°lk AdÄ±mlar", "YÃ¼rÃ¼meye baÅŸladÄ±n! Annen Ã§ok mutlu.", [{ text: "Harika!", action: () => { } }]);
        document.getElementById("voiceMom").play();
      } else if (player.age === 3) {
        showEvent("Ana KucaÄŸÄ±", "Annen seni besliyor ve ninniler sÃ¶ylÃ¼yor...", [{ text: "Huzur iÃ§inde bÃ¼yÃ¼", action: () => { } }]);
        document.getElementById("voiceMom").play();
      } else if (player.age === 6) {
        showEvent("Okul Ã‡aÄŸÄ±", "Ä°lkokula baÅŸlÄ±yorsun! Yeni arkadaÅŸlar edinecek misin?", [
          { text: "Evet!", action: () => { player.karma += 5; } },
          { text: "SÄ±kÄ±cÄ±...", action: () => { player.karma -= 2; } }
        ]);
        createCityScene(); // Simulate going to school/city
      } else if (player.age === 15) {
        showEvent("Ergenlik!", "ErgenliÄŸe girdin. NasÄ±l bir genÃ§ olacaksÄ±n?", [
          { text: "Derslerine odaklan", action: () => { player.karma += 5; player.money += 100; } },
          { text: "ArkadaÅŸlarla gez", action: () => { player.karma += 1; } },
          { text: "Bela ara", action: () => { player.karma -= 10; player.money -= 50; } }
        ]);
      } else if (player.age === 18) {
        showEvent("ReÅŸit Oldun!", "ArtÄ±k yetiÅŸkinsin! HayatÄ±nda ne yapacaksÄ±n?", [
          { text: "Ãœniversiteye git", action: () => { player.money -= 500; } }, // Cost of university
          { text: "Ä°ÅŸ hayatÄ±na atÄ±l", action: () => { player.money += 200; } }
        ]);
        // Ask about military service at 20, as per the request
      } else if (player.age === 20 && player.militaryStatus === "Muaf DeÄŸil" && player.militaryDraftAttempts < 3) {
        askForMilitaryService();
      } else if (player.age === 25 && !player.isMarried) {
        showEvent("Evlilik ZamanÄ±?", "Evlilik dÃ¼ÅŸÃ¼nceleri aklÄ±na gelmeye baÅŸladÄ±. Birini bulabilecek misin?", [
          { text: "Evet, birini ara", action: () => { attemptMarriage(); } },
          { text: "HenÃ¼z deÄŸil, kariyer Ã¶nceliÄŸim", action: () => { player.money += 1000; } }
        ]);
      } else if (player.age === 30 && !player.hasHouse) {
        showEvent("Ev Alma ZamanÄ±?", "Bir ev satÄ±n almak ister misin? (5000â‚º)", [
          { text: "Evet, al", action: () => { buyHouse(); } },
          { text: "HayÄ±r, kirada kal", action: () => { player.money -= 100; } }
        ]);
      } else if (player.age === 35 && !player.hasCar) {
        showEvent("Araba Alma ZamanÄ±?", "Bir araba almak ister misin? (2000â‚º)", [
          { text: "Evet, al", action: () => { buyCar(); } },
          { text: "HayÄ±r, toplu taÅŸÄ±ma kullan", action: () => { } }
        ]);
      } else if (player.age === 40) {
        showEvent("HayatÄ±n OrtasÄ±", "HayatÄ±nÄ±n ortalarÄ±na geldin. Ne hissediyorsun?", [
          { text: "Huzurluyum", action: () => { player.karma += 5; } },
          { text: "PiÅŸmanlÄ±klarÄ±m var", action: () => { player.karma -= 5; } }
        ]);
      } else if (player.age === 60) {
        showEvent("Emeklilik", "Emekli oldun! ArtÄ±k daha rahat bir hayatÄ±n var.", [
          { text: "Dinlen", action: () => { player.money += 2000; } },
          { text: "Hobi edin", action: () => { player.karma += 10; } }
        ]);
      } else if (player.age === 70 && Math.random() < 0.3) { // Chance of illness
        showEvent("SaÄŸlÄ±k SorunlarÄ±", "YaÅŸlÄ±lÄ±k belirtileri baÅŸladÄ±. Doktor kontrolÃ¼nden geÃ§melisin.", [
          { text: "Doktora git (200â‚º)", action: () => { player.money -= 200; showEvent("Tedavi", "Ä°yileÅŸtin!", [{ text: "Oh be!", action: () => { } }]); } },
          { text: "Umursama", action: () => { showEvent("KÃ¶tÃ¼leÅŸme", "HastalÄ±ÄŸÄ±n ilerledi, karmadan dÃ¼ÅŸtÃ¼!", [{ text: "Lanet olsun", action: () => { player.karma -= 15; } }]); } }
        ]);
      } else if (player.age >= 80) {
        showEvent("Son YÄ±llar", "HayatÄ±nÄ±n son demlerindesin. Geride ne bÄ±rakacaksÄ±n?", [
          { text: "Hayata veda et...", action: () => { endGame(); } }
        ]);
      }

      // Random events based on Karma
      if (Math.random() < 0.1) { // 10% chance each year for a random event
        handleRandomEvent();
      }
    }

    function askForMilitaryService() {
      player.militaryDraftAttempts++;
      showEvent("Askerlik Ã‡aÄŸrÄ±sÄ±", "20 yaÅŸÄ±na geldin ve askerlik Ã§aÄŸrÄ±n geldi. Ne yapmak istersin?", [
        { text: "AskerliÄŸe git (Normal)", action: () => { startMilitaryService("normal"); } },
        { text: "Bedelli yap (180.000â‚º)", action: () => { startMilitaryService("bedelli"); } },
        { text: "Åimdilik gitme (5 yÄ±l sonra tekrar sorulacak)", action: () => { player.militaryStatus = "Muaf DeÄŸil"; } }
      ]);

      if (player.militaryDraftAttempts >= 3 && player.militaryStatus === "Muaf DeÄŸil") {
        showEvent("Zorunlu Askerlik!", "Ã‡ok fazla kaÃ§tÄ±n! ArtÄ±k zorla askere alÄ±nÄ±yorsun.", [
          { text: "TamamdÄ±r...", action: () => { startMilitaryService("normal"); } }
        ]);
      }
    }

    function startMilitaryService(type) {
      clearInterval(ageInterval); // Pause aging during military service
      createMilitaryScene();
      militaryInfoDiv.style.display = "block";

      if (type === "normal") {
        player.militaryStatus = "Askere Gitti";
        player.militaryServiceRemaining = 365; // 1 year of service
        showEvent("Askerlik BaÅŸladÄ±!", "KÄ±ÅŸlaya katÄ±ldÄ±n. Yeni hayatÄ±na hoÅŸ geldin!", [
          { text: "GÃ¶rev bilinciyle...", action: () => { player.karma += 10; } }
        ]);
        militaryInterval = setInterval(updateMilitaryService, 1000); // Update daily (fast for demo)
      } else if (type === "bedelli") {
        if (player.money >= 180000) {
          player.money -= 180000;
          player.militaryStatus = "Bedelli YaptÄ±";
          player.militaryServiceRemaining = 21; // 21 days for bedelli
          showEvent("Bedelli YaptÄ±n!", "ParalÄ± askerlik hizmetini tamamladÄ±n. HayatÄ±na devam edebilirsin.", [
            { text: "Oh be!", action: () => { } }
          ]);
          militaryInterval = setInterval(updateMilitaryService, 500); // Faster for bedelli
        } else {
          showEvent("Yetersiz Para", "Bedelli askerlik iÃ§in yeterli paran yok! Normal askerlik veya erteleme seÃ§melisin.", [
            { text: "AnladÄ±m", action: () => { askForMilitaryService(); } } // Re-prompt
          ]);
          player.militaryStatus = "Muaf DeÄŸil"; // Reset status since action failed
          ageInterval = setInterval(() => {
            player.age++;
            updateInfo();
            handleLifeEvents();
          }, 5000); // Resume aging
        }
      }
    }

    function updateMilitaryService() {
      player.militaryServiceRemaining--;
      safakCounterSpan.innerText = player.militaryServiceRemaining;
      militaryStatusSpan.innerText = player.militaryStatus;

      if (player.militaryServiceRemaining <= 0) {
        clearInterval(militaryInterval);
        militaryInfoDiv.style.display = "none";
        player.militaryStatus = "TamamlandÄ±";
        showEvent("Terhis!", "AskerliÄŸin bitti! Sivil hayata geri dÃ¶nÃ¼yorsun.", [
          { text: "HayÄ±rlÄ± teskereler!", action: () => { createCityScene(); } }
        ]);
        ageInterval = setInterval(() => {
          player.age++;
          updateInfo();
          handleLifeEvents();
        }, 5000); // Resume aging
      } else if (player.militaryStatus === "Askere Gitti") {
        // Daily events during military service
        if (player.militaryServiceRemaining % 30 === 0) { // Monthly event
          const randomEvent = Math.random();
          if (randomEvent < 0.3) {
            showEvent("Askerlik OlayÄ±", "Patates soyma gÃ¶revi aldÄ±n.", [
              { text: "Soy", action: () => { player.karma += 1; } },
              { text: "Ä°tiraz et", action: () => { player.karma -= 5; showEvent("Ceza!", "Komutan ceza verdi.", [{ text: "TÃ¼h", action: () => { } }]); } }
            ]);
          } else if (randomEvent < 0.6) {
            showEvent("Askerlik OlayÄ±", "SavaÅŸa katÄ±lmak zorunda kaldÄ±n!", [
              { text: "Cesurca savaÅŸ", action: () => { player.karma += 15; showEvent("KahramanlÄ±k!", "Takdir edildin.", [{ text: "TeÅŸekkÃ¼rler", action: () => { } }]); } },
              { text: "Saklan", action: () => { player.karma -= 10; showEvent("KorkaklÄ±k!", "Ceza aldÄ±n.", [{ text: "Eyvah", action: () => { } }]); } }
            ]);
            document.getElementById("explosion").play();
          } else if (randomEvent < 0.8) {
            showEvent("Firar ÅansÄ±", "Firar etmek ister misin? Ã‡ok riskli!", [
              { text: "Firar et", action: () => { attemptDesertion(); } },
              { text: "KÄ±ÅŸlada kal", action: () => { } }
            ]);
          }
        }
      }
      updateInfo(); // Update info immediately after each military day/event
    }

    function attemptDesertion() {
      clearInterval(militaryInterval); // Pause military service
      militaryInfoDiv.style.display = "none";
      player.militaryStatus = "Firari";
      createCityScene(); // Back to city environment
      showEvent("Firar Ettin!", "KÄ±ÅŸladan kaÃ§tÄ±n! Polis seni arayacak...", [
        { text: "Saklanmaya Ã§alÄ±ÅŸ", action: () => { player.karma -= 20; handleDesertionChase(); } }
      ]);
      document.getElementById("carHorn").play(); // Simulate police car
    }

    function handleDesertionChase() {
      let chaseAttempts = 0;
      const chaseInterval = setInterval(() => {
        chaseAttempts++;
        if (chaseAttempts > 5) { // After 5 "years" of chase attempts (or more frequent updates)
          clearInterval(chaseInterval);
          if (Math.random() < 0.7) { // 70% chance of being caught
            showEvent("YakalandÄ±n!", "Polis seni yakaladÄ± ve askere geri gÃ¶tÃ¼rÃ¼yor!", [
              { text: "Lanet olsun", action: () => { startMilitaryService("normal"); player.militaryServiceRemaining += 180; player.karma -= 50; } } // Add 6 months to service
            ]);
          } else {
            showEvent("KaÃ§mayÄ± BaÅŸardÄ±n!", "Polisten kaÃ§mayÄ± baÅŸardÄ±n! ArtÄ±k Ã¶zgÃ¼rsÃ¼n ama firarisin.", [
              { text: "Yeni bir hayata baÅŸla", action: () => { } }
            ]);
            player.militaryStatus = "Firari (BaÅŸarÄ±lÄ±)"; // A new status for successful evasion
            ageInterval = setInterval(() => {
              player.age++;
              updateInfo();
              handleLifeEvents();
            }, 5000); // Resume aging
          }
        } else {
          showEvent("KaÃ§Ä±ÅŸ Devam Ediyor...", `Polis seni aramaya devam ediyor. (${5 - chaseAttempts} deneme kaldÄ±)`, [
            { text: "KÃ¶ÅŸeye gizlen", action: () => { } },
            { text: "KÄ±lÄ±k deÄŸiÅŸtir", action: () => { } }
          ]);
        }
      }, 5000); // Each 5 seconds is a chase attempt/tick
    }

    function attemptMarriage() {
      const partnerChance = Math.random();
      if (partnerChance < 0.6) { // 60% chance to find someone
        player.isMarried = true;
        showEvent("Evlendin!", "Hayat arkadaÅŸÄ±nÄ± buldun ve evlendiniz! Mutluluklar dileriz.", [
          { text: "Ã‡ok mutluyum!", action: () => { player.karma += 20; } }
        ]);
      } else {
        showEvent("Evlenemedin", "Uygun birini bulamadÄ±n veya evlilik kÄ±smetin olmadÄ±. Tekrar dene?", [
          { text: "ÅansÄ±mÄ± denerim", action: () => { } },
          { text: "YalnÄ±z kalacaÄŸÄ±m", action: () => { player.karma -= 5; } }
        ]);
      }
    }

    function buyHouse() {
      if (player.money >= 5000) {
        player.money -= 5000;
        player.hasHouse = true;
        showEvent("Ev AldÄ±n!", "Kendi evine sahip oldun! ArtÄ±k kira derdin yok.", [
          { text: "Harika!", action: () => { player.karma += 10; } }
        ]);
        createHomeScene(); // Switch back to a better "home" scene
      } else {
        showEvent("Yetersiz Para", "Ev almak iÃ§in yeterli paran yok!", [
          { text: "Daha Ã§ok Ã§alÄ±ÅŸmalÄ±yÄ±m", action: () => { } }
        ]);
      }
    }

    function buyCar() {
      if (player.money >= 2000) {
        player.money -= 2000;
        player.hasCar = true;
        showEvent("Araba AldÄ±n!", "Kendi araban var! UlaÅŸÄ±m artÄ±k Ã§ok daha kolay.", [
          { text: "Yola Ã§Ä±kalÄ±m!", action: () => { player.karma += 5; } }
        ]);
      } else {
        showEvent("Yetersiz Para", "Araba almak iÃ§in yeterli paran yok!", [
          { text: "Daha Ã§ok para biriktir", action: () => { } }
        ]);
      }
    }

    function handleRandomEvent() {
      const eventType = Math.random();

      if (eventType < 0.3) {
        // Good event
        showEvent("ÅanslÄ± GÃ¼n!", "Yolda para buldun!", [
          { text: "Al", action: () => { player.money += 100; player.karma += 1; } },
          { text: "Karakola teslim et", action: () => { showEvent("DÃ¼rÃ¼stlÃ¼k!", "Ã‡ok dÃ¼rÃ¼st davrandÄ±n. Karma puanÄ±n arttÄ±!", [{ text: "GÃ¶rev tamam", action: () => { player.karma += 10; } }]); } }
        ]);
      } else if (eventType < 0.6) {
        // Bad event
        showEvent("KÃ¶tÃ¼ Bir GÃ¼n", "Cebindeki paranÄ± Ã§aldÄ±rdÄ±n!", [
          { text: "Lanet olsun!", action: () => { player.money = Math.max(0, player.money - 500); player.karma -= 2; } }
        ]);
      } else if (eventType < 0.8) {
        // Moral dilemma
        showEvent("Ahlaki Ä°kilem", "Bir arkadaÅŸÄ±n senden yasa dÄ±ÅŸÄ± bir iÅŸe katÄ±lmanÄ± istiyor.", [
          { text: "Kabul et (Riskli ama kazanÃ§lÄ±)", action: () => { attemptCrime(); } },
          { text: "Reddet (GÃ¼venli)", action: () => { player.karma += 5; showEvent("DÃ¼rÃ¼stlÃ¼k", "ArkadaÅŸÄ±nÄ± reddettin, doÄŸru olanÄ± yaptÄ±n.", [{ text: "Ä°yi insan", action: () => { } }]); } }
        ]);
      } else {
        // Generic event
        showEvent("SÄ±radan Bir GÃ¼n", "Yeni bir hobiye baÅŸlamak ister misin?", [
          { text: "Evet (100â‚º)", action: () => { player.money -= 100; player.karma += 3; } },
          { text: "HayÄ±r", action: () => { } }
        ]);
      }
    }

    function attemptCrime() {
      const crimeType = Math.random();
      if (crimeType < 0.5) { // Bank Robbery
        showEvent("Banka Soygunu PlanÄ±!", "Bir banka soygununa katÄ±lmak ister misin? YakalanÄ±rsan hapishane...", [
          { text: "Evet, soy", action: () => { executeBankRobbery(); } },
          { text: "HayÄ±r, Ã§ok riskli", action: () => { player.karma += 1; } }
        ]);
      } else { // Car Theft
        showEvent("Araba Ã‡alma FÄ±rsatÄ±!", "Park edilmiÅŸ lÃ¼ks bir araba gÃ¶rdÃ¼n. Ã‡almak ister misin?", [
          { text: "Evet, Ã§al", action: () => { executeCarTheft(); } },
          { text: "HayÄ±r, baÅŸÄ±m belaya girmesin", action: () => { player.karma += 1; } }
        ]);
      }
    }

    function executeBankRobbery() {
      const successChance = Math.random();
      if (successChance < 0.3) { // 30% success chance
        const loot = Math.floor(Math.random() * 5000) + 1000;
        player.money += loot;
        player.karma -= 50;
        showEvent("Soygun BaÅŸarÄ±lÄ±!", `BankayÄ± soydun ve ${loot}â‚º kazandÄ±n!`, [
          { text: "Zengin oldum!", action: () => { } }
        ]);
        document.getElementById("explosion").play(); // Sound effect for action
      } else {
        player.karma -= 100;
        showEvent("YakalandÄ±n!", "Banka soygununda yakalandÄ±n! Hapse giriyorsun.", [
          { text: "Hapishaneye git", action: () => { goToPrison(5); } } // 5 years in prison
        ]);
      }
    }

    function executeCarTheft() {
      const successChance = Math.random();
      if (successChance < 0.6) { // 60% success chance
        player.hasCar = true;
        player.money += 500; // Sell value or direct use
        player.karma -= 20;
        showEvent("Araba Ã‡alÄ±ndÄ±!", "Araba senin oldu! Satabilir veya kullanabilirsin.", [
          { text: "SÃ¼per!", action: () => { } }
        ]);
        document.getElementById("carHorn").play();
      } else {
        player.karma -= 40;
        showEvent("YakalandÄ±n!", "Araba Ã§alarken yakalandÄ±n! Hapse giriyorsun.", [
          { text: "Hapishaneye git", action: () => { goToPrison(2); } } // 2 years in prison
        ]);
      }
    }

    function goToPrison(years) {
      clearInterval(ageInterval); // Stop aging
      showEvent("Hapishane!", `Hapishaneye girdin. ${years} yÄ±l hapis yatacaksÄ±n.`, [
        { text: "Zor zamanlar...", action: () => { } }
      ]);
      const prisonSentenceInterval = setInterval(() => {
        years--;
        showEvent("Hapishane...", `Hapishanede ${years} yÄ±lÄ±n kaldÄ±.`, [
          { text: "Bekle...", action: () => { } }
        ]);
        if (years <= 0) {
          clearInterval(prisonSentenceInterval);
          showEvent("Ã–zgÃ¼rlÃ¼k!", "Hapisten Ã§Ä±ktÄ±n! Yeni bir baÅŸlangÄ±Ã§ yapabilirsin.", [
            { text: "Hayata geri dÃ¶n", action: () => { } }
          ]);
          ageInterval = setInterval(() => {
            player.age++;
            updateInfo();
            handleLifeEvents();
          }, 5000); // Resume aging
        }
      }, 5000); // Each 5 seconds is 1 year in prison
    }

    function endGame() {
      clearInterval(ageInterval);
      if (militaryInterval) clearInterval(militaryInterval);
      hideEvent();
      document.getElementById("ui").style.display = "flex"; // Show UI again
      document.getElementById("ui").innerHTML = `
        <h1>Hayat YolculuÄŸunun Sonu</h1>
        <p>${player.name} ${player.surname}, ${player.age} yaÅŸÄ±nda hayatÄ±nÄ± kaybetti.</p>
        <p>HayatÄ±nda topladÄ±ÄŸÄ±n Karma puanÄ±: ${player.karma}</p>
        <p>Kalan Para: ${player.money}â‚º</p>
        <p>${player.karma >= 0 ? "GÃ¼zel bir hayat yaÅŸadÄ±n, ardÄ±nda iyi anÄ±lar bÄ±raktÄ±n." : "HayatÄ±nda bazÄ± kÃ¶tÃ¼ seÃ§imler yaptÄ±n, ancak her zaman yeni bir baÅŸlangÄ±Ã§ fÄ±rsatÄ± vardÄ±r."}</p>
        <button onclick="location.reload()">Tekrar Dene</button>
      `;
      // Clear canvas and scene elements
      scene.clear();
      renderer.setClearColor(0x000000);
      info.style.display = 'none';
      militaryInfoDiv.style.display = 'none';
    }


    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
